<?php
if (!defined("ROOT_PATH"))
{
	header("HTTP/1.1 403 Forbidden");
	exit;
}
require_once dirname(__FILE__) . '/pjInvoiceApp.model.php';
class pjInvoiceModel extends pjInvoiceAppModel
{
	protected $primaryKey = 'id';
	
	protected $table = 'plugin_invoice';
	
	protected $schema = array(
		array('name' => 'id', 'type' => 'int', 'default' => ':NULL'),
		array('name' => 'uuid', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'order_id', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'foreign_id', 'type' => 'int', 'default' => ':NULL'),
		array('name' => 'issue_date', 'type' => 'date', 'default' => ':NULL'),
		array('name' => 'due_date', 'type' => 'date', 'default' => ':NULL'),
		array('name' => 'created', 'type' => 'datetime', 'default' => ':NOW()'),
		array('name' => 'modified', 'type' => 'datetime', 'default' => ':NULL'),
		array('name' => 'status', 'type' => 'enum', 'default' => ':NULL'),
		array('name' => 'txn_id', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'processed_on', 'type' => 'datetime', 'default' => ':NULL'),
		array('name' => 'subtotal', 'type' => 'decimal', 'default' => 0),
		array('name' => 'discount', 'type' => 'decimal', 'default' => 0),
		array('name' => 'tax', 'type' => 'decimal', 'default' => 0),
		array('name' => 'shipping', 'type' => 'decimal', 'default' => 0),
		array('name' => 'total', 'type' => 'decimal', 'default' => 0),
		array('name' => 'paid_deposit', 'type' => 'decimal', 'default' => 0),
		array('name' => 'amount_due', 'type' => 'decimal', 'default' => 0),
		array('name' => 'currency', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'notes', 'type' => 'text', 'default' => ':NULL'),
		array('name' => 'y_logo', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_company', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_name', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_street_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_city', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_state', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_zip', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_phone', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_fax', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_email', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'y_url', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_billing_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_company', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_name', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_street_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_city', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_state', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_zip', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_phone', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_fax', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_email', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 'b_url', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_shipping_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_company', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_name', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_street_address', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_city', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_state', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_zip', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_phone', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_fax', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_email', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_url', 'type' => 'varchar', 'default' => ':NULL'),
		array('name' => 's_date', 'type' => 'date', 'default' => ':NULL'),
		array('name' => 's_terms', 'type' => 'text', 'default' => ':NULL'),
		array('name' => 's_is_shipped', 'type' => 'tinyint', 'default' => 0)
	);
	
	protected $validate = array(
		'rules' => array(
			'uuid' => array(
				'pjActionAlphaNumeric' => true,
				'pjActionNotEmpty' => true,
				'pjActionRequired' => true
			),
			'order_id' => array(
				'pjActionAlphaNumeric' => true,
				'pjActionNotEmpty' => true,
				'pjActionRequired' => true
			),
			'foreign_id' => array(
				'pjActionNumeric' => true,
				'pjActionNotEmpty' => true,
				'pjActionRequired' => true
			),
			'issue_from' => array(
				'rule' => array('pjActionDate', 'ymd', '/\d{4}-\d{2}-\d{2}/'),
				'pjActionRequired' => true,
				'pjActionNotEmpty' => true
			),
			'due_to' => array(
				'rule' => array('pjActionDate', 'ymd', '/\d{4}-\d{2}-\d{2}/'),
				'pjActionRequired' => true,
				'pjActionNotEmpty' => true
			)
		)
	);
	
	public static function factory($attr=array())
	{
		return new pjInvoiceModel($attr);
	}
	
	public function pjActionSetup()
	{
		$field_arr = array(
			0 => array('plugin_invoice_menu_invoices', 'Invoice plugin / Menu Invoices'),
			1 => array('plugin_invoice_config', 'Invoice plugin / Invoice config'),
			2 => array('plugin_invoice_i_logo', 'Invoice plugin / Company logo'),
			3 => array('plugin_invoice_i_company', 'Invoice plugin / Company name'),
			4 => array('plugin_invoice_i_name', 'Invoice plugin / Name'),
			5 => array('plugin_invoice_i_street_address', 'Invoice plugin / Street address'),
			6 => array('plugin_invoice_i_city', 'Invoice plugin / City'),
			7 => array('plugin_invoice_i_state', 'Invoice plugin / State'),
			8 => array('plugin_invoice_i_zip', 'Invoice plugin / Zip'),
			9 => array('plugin_invoice_i_phone', 'Invoice plugin / Phone'),
			10 => array('plugin_invoice_i_fax', 'Invoice plugin / Fax'),
			11 => array('plugin_invoice_i_email', 'Invoice plugin / Email'),
			12 => array('plugin_invoice_i_url', 'Invoice plugin / Website'),
			13 => array('error_titles_ARRAY_PIN01', 'Invoice plugin / Info title', 'arrays'),
			14 => array('error_bodies_ARRAY_PIN01', 'Invoice plugin / Info body', 'arrays'),
			15 => array('error_titles_ARRAY_PIN02', 'Invoice plugin / Invoice config updated title', 'arrays'),
			16 => array('error_bodies_ARRAY_PIN02', 'Invoice plugin / Info body', 'arrays'),
			17 => array('error_titles_ARRAY_PIN03', 'Invoice plugin / Upload failed', 'arrays'),
			18 => array('plugin_invoice_template', 'Invoice plugin / Invoice Template'),
			20 => array('plugin_invoice_delete_logo_title', 'Invoice plugin / Delete logo title'),
			21 => array('plugin_invoice_delete_logo_body', 'Invoice plugin / Delete logo body'),
			22 => array('plugin_invoice_billing_info', 'Invoice plugin / Billing information'),
			23 => array('plugin_invoice_shipping_info', 'Invoice plugin / Shipping information'),
			24 => array('plugin_invoice_company_info', 'Invoice plugin / Company information'),
			25 => array('plugin_invoice_payment_info', 'Invoice plugin / Payment information'),
			26 => array('plugin_invoice_i_address', 'Invoice plugin / Address'),
			27 => array('plugin_invoice_i_billing_address', 'Invoice plugin / Billing address'),
			28 => array('plugin_invoice_general_info', 'Invoice plugin / General information'),
			29 => array('plugin_invoice_i_uuid', 'Invoice plugin / Invoice no.'),
			30 => array('plugin_invoice_i_order_id', 'Invoice plugin / Order no.'),
			31 => array('plugin_invoice_i_issue_date', 'Invoice plugin / Issue date'),
			32 => array('plugin_invoice_i_due_date', 'Invoice plugin / Due date'),
			33 => array('plugin_invoice_i_shipping_date', 'Invoice plugin / Shipping date'),
			34 => array('plugin_invoice_i_shipping_terms', 'Invoice plugin / Shipping terms'),
			35 => array('plugin_invoice_i_subtotal', 'Invoice plugin / Subtotal'),
			36 => array('plugin_invoice_i_discount', 'Invoice plugin / Discount'),
			37 => array('plugin_invoice_i_tax', 'Invoice plugin / Tax'),
			38 => array('plugin_invoice_i_shipping', 'Invoice plugin / Tax'),
			39 => array('plugin_invoice_i_total', 'Invoice plugin / Total'),
			40 => array('plugin_invoice_i_paid_deposit', 'Invoice plugin / Paid deposit'),
			41 => array('plugin_invoice_i_amount_due', 'Invoice plugin / Amount due'),
			42 => array('plugin_invoice_i_currency', 'Invoice plugin / Currency'),
			43 => array('plugin_invoice_i_notes', 'Invoice plugin / Notes'),
			44 => array('plugin_invoice_i_shipping_address', 'Invoice plugin / Shipping address'),
			45 => array('plugin_invoice_i_created', 'Invoice plugin / Created'),
			46 => array('plugin_invoice_i_modified', 'Invoice plugin / Modified'),
			47 => array('plugin_invoice_i_item', 'Invoice plugin / Item'),
			48 => array('plugin_invoice_i_qty', 'Invoice plugin / Qty'),
			49 => array('plugin_invoice_i_unit', 'Invoice plugin / Unit price'),
			50 => array('plugin_invoice_i_amount', 'Invoice plugin / Amount'),
			51 => array('plugin_invoice_add_item_title', 'Invoice plugin / Add item title'),
			52 => array('plugin_invoice_edit_item_title', 'Invoice plugin / Update item title'),
			53 => array('plugin_invoice_i_description', 'Invoice plugin / Description'),
			54 => array('plugin_invoice_i_accept_payments', 'Invoice plugin / Accept payments'),
			55 => array('plugin_invoice_print', 'Invoice plugin / Print invoice'),
			56 => array('plugin_invoice_send', 'Invoice plugin / Send invoice'),
			57 => array('plugin_invoice_view', 'Invoice plugin / View invoice'),
			58 => array('plugin_invoice_send_invoice_title', 'Invoice plugin / Send invoice dialog title'),
			59 => array('plugin_invoice_send_subject', 'Invoice plugin / Send invoice subject'),
			60 => array('plugin_invoice_items_info', 'Invoice plugin / Items information'),
			61 => array('plugin_invoice_i_accept_paypal', 'Invoice plugin / Accept payments with PayPal'),
			62 => array('plugin_invoice_i_accept_authorize', 'Invoice plugin / Accept payments with Authorize.NET'),
			63 => array('plugin_invoice_i_accept_creditcard', 'Invoice plugin / Accept payments with Credit Card'),
			64 => array('plugin_invoice_i_accept_bank', 'Invoice plugin / Accept payments with Bank Account'),
			65 => array('plugin_invoice_i_s_include', 'Invoice plugin / Include Shipping information'),
			66 => array('plugin_invoice_i_s_shipping_address', 'Invoice plugin / Include Shipping address'),
			67 => array('plugin_invoice_i_s_company', 'Invoice plugin / Include Company'),
			68 => array('plugin_invoice_i_s_name', 'Invoice plugin / Include Name'),
			69 => array('plugin_invoice_i_s_address', 'Invoice plugin / Include Address'),
			70 => array('plugin_invoice_i_s_city', 'Invoice plugin / Include City'),
			71 => array('plugin_invoice_i_s_state', 'Invoice plugin / Include State'),
			72 => array('plugin_invoice_i_s_zip', 'Invoice plugin / Include Zip'),
			73 => array('plugin_invoice_i_s_phone', 'Invoice plugin / Include Phone'),
			74 => array('plugin_invoice_i_s_fax', 'Invoice plugin / Include Fax'),
			75 => array('plugin_invoice_i_s_email', 'Invoice plugin / Include Email'),
			76 => array('plugin_invoice_i_s_url', 'Invoice plugin / Include Website'),
			77 => array('plugin_invoice_i_s_street_address', 'Invoice plugin / Include Street address'),
			78 => array('error_titles_ARRAY_PIN05', 'Invoice plugin / Invoice updated title', 'arrays'),
			79 => array('error_bodies_ARRAY_PIN05', 'Invoice plugin / Invoice updated body', 'arrays'),
			80 => array('error_titles_ARRAY_PIN04', 'Invoice plugin / Invoice Not Found title', 'arrays'),
			81 => array('error_bodies_ARRAY_PIN04', 'Invoice plugin / Invoice Not Found body', 'arrays'),
			82 => array('error_titles_ARRAY_PIN06', 'Invoice plugin / Invalid data title', 'arrays'),
			83 => array('error_bodies_ARRAY_PIN06', 'Invoice plugin / Invalid data body', 'arrays'),
			84 => array('plugin_invoice_i_status', 'Invoice plugin / Status'),
			85 => array('plugin_invoice_pay_with_paypal', 'Invoice plugin / Pay with Paypal'),
			86 => array('plugin_invoice_pay_with_authorize', 'Invoice plugin / Pay with Authorize.Net'),
			87 => array('plugin_invoice_pay_with_creditcard', 'Invoice plugin / Pay with Credit Card'),
			88 => array('plugin_invoice_pay_with_bank', 'Invoice plugin / Pay with Bank Account'),
			89 => array('plugin_invoice_pay_now', 'Invoice plugin / Pay Now'),
			90 => array('plugin_invoice_paypal_title', 'Invoice plugin / Paypal title', 'frontend'),
			91 => array('plugin_invoice_authorize_title', 'Invoice plugin / Payment Authorize title', 'frontend'),
			92 => array('plugin_invoice_i_paypal_address', 'Invoice plugin / Paypal address'),
			93 => array('plugin_invoice_i_authorize_tz', 'Invoice plugin / Authorize.Net Timezone'),
			94 => array('plugin_invoice_i_authorize_mid', 'Invoice plugin / Authorize.Net Merchant ID'),
			95 => array('plugin_invoice_i_authorize_key', 'Invoice plugin / Authorize.Net Transaction Key'),
			96 => array('plugin_invoice_i_bank_account', 'Invoice plugin / Bank Account'),
			97 => array('plugin_invoice_paypal_redirect', 'Invoice plugin / Paypal redirect'),
			98 => array('plugin_invoice_authorize_redirect', 'Invoice plugin / Authorize.Net redirect'),
			99 => array('plugin_invoice_paypal_proceed', 'Invoice plugin / Paypal proceed button'),
			100 => array('plugin_invoice_authorize_proceed', 'Invoice plugin / Authorize.Net proceed button'),
			101 => array('plugin_invoice_i_delete_title', 'Invoice plugin / Delete title'),
			102 => array('plugin_invoice_i_delete_body', 'Invoice plugin / Delete body'),
			103 => array('plugin_invoice_i_is_shipped', 'Invoice plugin / Is shipped'),
			104 => array('plugin_invoice_i_s_date', 'Invoice plugin / Include Shipping date'),
			105 => array('plugin_invoice_i_s_terms', 'Invoice plugin / Include Shipping terms'),
			106 => array('plugin_invoice_i_s_is_shipped', 'Invoice plugin / Include Is Shipped'),
			107 => array('plugin_invoice_statuses_ARRAY_not_paid', 'Invoice plugin / Status: Not Paid', 'arrays'),
			108 => array('plugin_invoice_statuses_ARRAY_paid', 'Invoice plugin / Status: Paid', 'arrays'),
			109 => array('plugin_invoice_statuses_ARRAY_cancelled', 'Invoice plugin / Status: Cancelled', 'arrays'),
			110 => array('plugin_invoice_i_num', 'Invoice plugin / No.'),
			111 => array('plugin_invoice_add', 'Invoice plugin / Add'),
			112 => array('plugin_invoice_save', 'Invoice plugin / Save'),
			113 => array('plugin_invoice_i_booking_url', 'Invoice plugin / Booking URL - Token: {ORDER_ID}'),
			114 => array('plugin_invoice_i_s_shipping', 'Invoice plugin / Include Shipping'),
			115 => array('error_titles_ARRAY_PIN07', 'Invoice plugin / Invoice added title', 'arrays'),
			116 => array('error_bodies_ARRAY_PIN07', 'Invoice plugin / Invoice added body', 'arrays'),
			117 => array('error_titles_ARRAY_PIN08', 'Invoice plugin / Invoice failed to add title', 'arrays'),
			118 => array('error_bodies_ARRAY_PIN08', 'Invoice plugin / Invoice failed to add body', 'arrays'),
			119 => array('error_titles_ARRAY_PIN09', 'Invoice plugin / Invoice Send title', 'arrays'),
			120 => array('error_bodies_ARRAY_PIN09', 'Invoice plugin / Invoice send body', 'arrays'),
			121 => array('error_titles_ARRAY_PIN10', 'Invoice plugin / Invoice heading title', 'arrays'),
			122 => array('error_bodies_ARRAY_PIN10', 'Invoice plugin / Invoice heading body', 'arrays'),
			123 => array('error_titles_ARRAY_PIN11', 'Invoice plugin / Invoice billing title', 'arrays'),
			124 => array('error_bodies_ARRAY_PIN11', 'Invoice plugin / Invoice billing body', 'arrays'),
			125 => array('plugin_invoice_i_qty_is_int', 'Invoice plugin / Quantity format'),
			126 => array('plugin_invoice_i_qty_int', 'Invoice plugin / Quantity INT instead of FLOAT'),
			127 => array('plugin_invoice_i_authorize_hash', 'Invoice plugin / Authorize.Net hash value'),
		);
		
		$multi_arr = array(
			0 => array('Invoices'),
			1 => array('Invoice Config'),
			2 => array('Company logo'),
			3 => array('Company name'),
			4 => array('Name'),
			5 => array('Street address'),
			6 => array('City'),
			7 => array('State'),
			8 => array('Zip'),
			9 => array('Phone'),
			10 => array('Fax'),
			11 => array('Email'),
			12 => array('Website'),
			13 => array('Invoice'),
			14 => array('In order to configure the invoices module you need to fill in your company details. To view all invoices <a href="index.php?controller=pjInvoice&action=pjActionInvoices">click here</a>'),
			15 => array('Invoice config updated!'),
			16 => array('Invoice config data has been properly updated.'),
			17 => array('Upload failed'),
			18 => array('Invoice Template'),
			20 => array('Delete confirmation'),
			21 => array('Are you sure you want to delete selected logo?'),
			22 => array('Billing information'),
			23 => array('Shipping information'),
			24 => array('Company information'),
			25 => array('Payment information'),
			26 => array('Address'),
			27 => array('Billing address'),
			28 => array('General information'),
			29 => array('Invoice no.'),
			30 => array('Order no.'),
			31 => array('Issue date'),
			32 => array('Due date'),
			33 => array('Shipping date'),
			34 => array('Shipping terms'),
			35 => array('Subtotal'),
			36 => array('Discount'),
			37 => array('Tax'),
			38 => array('Shipping'),
			39 => array('Total'),
			40 => array('Paid deposit'),
			41 => array('Amount due'),
			42 => array('Currency'),
			43 => array('Notes'),
			44 => array('Shipping address'),
			45 => array('Created'),
			46 => array('Modified'),
			47 => array('Item'),
			48 => array('Qty'),
			49 => array('Unit price'),
			50 => array('Amount'),
			51 => array('Add item'),
			52 => array('Update item'),
			53 => array('Description'),
			54 => array('Accept payments'),
			55 => array('PRINT'),
			56 => array('EMAIL'),
			57 => array('VIEW'),
			58 => array('Send invoice'),
			59 => array('Invoice'),
			60 => array('Items information'),
			61 => array('Accept payments with PayPal'),
			62 => array('Accept payments with Authorize.NET'),
			63 => array('Accept payments with Credit Card'),
			64 => array('Accept payments with Bank Account'),
			65 => array('Include Shipping information'),
			66 => array('Include Shipping address'),
			67 => array('Include Company'),
			68 => array('Include Name'),
			69 => array('Include Address'),
			70 => array('Include City'),
			71 => array('Include State'),
			72 => array('Include Zip'),
			73 => array('Include Phone'),
			74 => array('Include Fax'),
			75 => array('Include Email'),
			76 => array('Include Website'),
			77 => array('Include Street address'),
			78 => array('Invoice updated!'),
			79 => array('Invoice has been updated.'),
			80 => array('Invoice Not Found'),
			81 => array('Invoice with such ID was not found.'),
			82 => array('Update failed'),
			83 => array('Some of the data is not valid.'),
			84 => array('Status'),
			85 => array('Pay with Paypal'),
			86 => array('Pay with Authorize.Net'),
			87 => array('Pay with Credit Card'),
			88 => array('Pay with Bank Account'),
			89 => array('Pay Now'),
			90 => array('Invoice module'),
			91 => array('Invoice module'),
			92 => array('Paypal address'),
			93 => array('Authorize.Net Timezone'),
			94 => array('Authorize.Net Merchant ID'),
			95 => array('Authorize.Net Transaction Key'),
			96 => array('Bank Account'),
			97 => array('You will be redirected to Paypal in 3 seconds. If not please click on the button.'),
			98 => array('You will be redirected to Authorize.net in 3 seconds. If not please click on the button.'),
			99 => array('Proceed with payment'),
			100 => array('Proceed with payment'),
			101 => array('Delete selected'),
			102 => array('Are you sure you want to delete selected invoices?'),
			103 => array('Is shipped'),
			104 => array('Include Shipping date'),
			105 => array('Include Shipping terms'),
			106 => array('Include Is Shipped'),
			107 => array('NOT PAID'),
			108 => array('PAID'),
			109 => array('CANCELLED'),
			110 => array('No.'),
			111 => array('ADD +'),
			112 => array('SAVE'),
			113 => array('Booking URL - Token: {ORDER_ID}'),
			114 => array('Include Shipping'),
			115 => array('Invoice added!'),
			116 => array('Invoice has been added.'),
			117 => array('Invoice has not been added.'),
			118 => array('Invoice failed to add!'),
			119 => array('Notice'),
			120 => array('Check the email address(es) where invoice should be sent.'),
			121 => array('Invoice details'),
			122 => array('Fill in invoice details and use the buttons below to view, print or email the invoice.'),
			123 => array('Billing details'),
			124 => array('Under "Billing information" you can edit your customer billing details. Under "Company information" is your company billing information which will be used for the invoice.'),
			125 => array('Quantity format'),
			126 => array('Format as INT instead of FLOAT'),
			127 => array('Authorize.Net hash value')
		);
		
		$pjFieldModel = pjFieldModel::factory();
		$pjMultiLangModel = pjMultiLangModel::factory();
		pjObject::import('Model', 'pjLocale:pjLocale');
		$locale_arr = pjLocaleModel::factory()->findAll()->getDataPair('id', 'id');
		
		foreach ($field_arr as $key => $field)
		{
			$insert_id = $pjFieldModel->reset()->setAttributes(array(
				'key' => $field[0],
				'type' => !isset($field[2]) ? 'backend' : $field[2],
				'label' => $field[1],
				'source' => 'plugin'
			))->insert()->getInsertId();
			if ($insert_id !== false && (int) $insert_id > 0)
			{
				foreach ($locale_arr as $locale)
				{
					$pjMultiLangModel->reset()->setAttributes(array(
						'foreign_id' => $insert_id,
						'model' => 'pjField',
						'locale' => $locale,
						'field' => 'title',
						'content' => $multi_arr[$key][0],
						'source' => 'plugin'
					))->insert();
				}
			}
		}
	}
}
?>